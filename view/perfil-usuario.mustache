<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="icon" href="../public/assets/favicon.ico" type="image/x-icon">
</head>
<body class="d-flex align-items-center" >

{{#datos_usuario}}
    <div class="datos-container">
        {{#error}}
            <div class="error-message">
                <h1>{{error}}</h1>
            </div>
        {{/error}}
        <div class="datos">
            <div class="imagenYqr">
            <div class="imagen">
                <div> <img src="/public/img/users/{{imagen_perfil}}" alt="Imagen de perfil"></div>
                <div> <img class="img-fluid" src="/public/img/profile_qrs/{{id_usuario}}_qr.png" alt="CódigoQR"></div>

            </div>
            <div class="qr">
                <img class="img-fluid" src="/public/images/profile_qrs/{{id}}_qr.png" alt="CódigoQR">
            </div>
            </div>

            <div class="nombrePrincipales">
                <h1>¡Hola {{username}}!</h1><br>
                <h3>Mail: {{correo}}</h3> <br>
                <h3>Nombre completo: {{nombre}}</h3> <br>
                <h3>Calendario: {{nacimiento}}</h3> <br>
                <h3>Genero: {{genero}}</h3> <br>
                <h3>Pais: {{pais}}</h3> <br>
                <h3>Ciudad: {{ciudad}}</h3> <br>
                <h3>Latitud: <span id="latitud">{{latitud}}</span></h3> <br>
                <h3>Longitud: <span id="longitud">{{longitud}}</span></h3> <br>
            </div>
        </div>

        <div>


            <div class="map-container">
                <p hidden>Latitud: <span id="latitud">{{latitud}}</span></p>
                <p hidden>Longitud: <span id="longitud">{{longitud}}</span></p>
                <div id="map"></div>
            </div>
        </div>
        <div class="botonEditar">
            <div>
                <a href="/">Volver al home</a>
            </div>

            <div>
                {{#boton-editar}}
                    <a href="/PerfilUsuario/modificarUsuario">Editar datos</a>
                {{/boton-editar}}
            </div>



        </div>


    </div>
{{/datos_usuario}}


<footer>
    <div class="acomodarFooter">
        <div class="seccion1Footer">
        </div>
        <div class="drev">
            <p>Derechos Reservados ©2024 Preguntados. Todos los derechos reservados.</p>
        </div>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    var map, geocoder, marker;

    function initMap() {
        // Obtener las coordenadas desde el HTML
        var latitud = parseFloat(document.getElementById('latitud').textContent);
        var longitud = parseFloat(document.getElementById('longitud').textContent);

        // Inicializar el mapa en las coordenadas especificadas
        var latlng = { lat: latitud, lng: longitud };

        map = new google.maps.Map(document.getElementById('map'), {
            center: latlng,
            zoom: 12, // Ajusta el nivel de zoom según sea necesario
        });

        geocoder = new google.maps.Geocoder();

        // Colocar el marcador en las coordenadas especificadas
        marker = new google.maps.Marker({
            position: latlng,
            map: map
        });

        // Geocodificar la latitud y longitud para obtener país y ciudad
        geocodeLatLng(geocoder, latlng);

        map.addListener('click', function(e) {
            if (marker) {
                marker.setMap(null);
            }
            var latLng = e.latLng;
            document.getElementById('latitud').textContent = latLng.lat();
            document.getElementById('longitud').textContent = latLng.lng();
            geocodeLatLng(geocoder, latLng);

            // Enviar las coordenadas al backend para guardar
            fetch('/guardar_coordenadas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    latitud: latLng.lat(),
                    longitud: latLng.lng()
                })
            }).then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            console.log('Coordenadas guardadas exitosamente.');
                        } else {
                            console.error('Error al guardar las coordenadas.');
                        }
                    });
        });
    }

    function geocodeLatLng(geocoder, latlng) {
        geocoder.geocode({ location: latlng }, function(results, status) {
            if (status === 'OK') {
                if (results[0]) {
                    var components = results[0].address_components;
                    var country = '';
                    var city = '';
                    for (var i = 0; i < components.length; i++) {
                        var types = components[i].types;
                        if (types.includes('country')) {
                            country = components[i].long_name;
                        }
                        if (types.includes('locality')) {
                            city = components[i].long_name;
                        }
                    }
                    document.getElementById('pais').textContent = country;
                    document.getElementById('ciudad').textContent = city;
                } else {
                    alert('No se encontraron resultados de geocodificación.');
                }
            } else {
                alert('Geocode fallido: ' + status);
            }
        });
    }

    // Inicializar el mapa cuando el script de Google Maps esté cargado
    window.initMap = initMap;
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRMp94YG9PHRr-RSCqwmxUgEzRGxQIY10&callback=initMap" async defer></script>

</body>

<style>


    .datos-container {
        margin: 20px auto;
        max-width: 800px;
        background-color: #fff;
        padding: 20px;
        box-shadow: 0px 0px 0px 4px rgba(52, 52, 53, 0.185);
        border-radius: 10px;
        width: 100%;
        margin-top:3em;
        margin-bottom:6em;
    }

    .datos {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-around;
        margin-top: 0.5em;
    }

    .imagen {

        margin-top: 2em;

    }

    .imagen img {
        width: 200px;
        height: 200px;

    }

    .botonEditar {
        margin-bottom: 20px;

        display: flex;
        align-items: center;
        margin-top: 2em;
        justify-content: space-evenly;

    }

    .botonEditar a {
        text-decoration: none;
        color: white;
        font-weight: bold;
        border-radius: 1em;
        padding: 1em;
        background-color: black;
    }

    .botonEditar a:hover {
        color: black;
        background-color: white;
        border: 1px solid black;
    }

    .botonVolver{
        margin-bottom: 20px;
        align-items: center;
        margin-top: 1em;
    }

    .botonVolver a {
        text-decoration: none;
        color:black;
        font-weight: bold;
        border-radius: 1em ;
        padding: 1em;
        background-color: white;
    }


    .botones{
        display: flex;
        flex-direction: row;
        justify-content: space-evenly;
        flex-wrap: wrap;
        padding: 1em;
    }



    .datos h1 {
        font-size: 2rem;
        color: #1a202c;
        text-align: center;
    }

    .datos h3 {
        font-size: 1rem;
        color: #4a5568;
        margin-bottom: 5px;
        border: 1px solid;
        padding:0.4em;
    }



    body{
        background-image: url("/public/img/fondo.png");
        background-repeat: no-repeat;
        background-size: cover;
    }

    footer {
        background-color: white;
        width: 100%;
        box-sizing: border-box;
        position: fixed;
        bottom: 0;
        left: 0;
    }

    .acomodarFooter {
        margin: 1rem;
        align-items: center;
    }

    .drev {
        color:#343434;
        font-family: "Poppins", sans-serif;
        text-align: center;
    }

    #map {
        height: 400px;
        width: 100%;
    }

    .imagenYqr{
        display: flex;
        flex-direction: column;
    }

    .qr{
        margin-top: 2em;
    }

</style>
